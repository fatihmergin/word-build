<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DUAL SPIN 2048: ELEMENTAL RUSH</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@900&display=swap');

        body { margin: 0; overflow: hidden; background-color: #1a1a2e; font-family: 'Orbitron', sans-serif; touch-action: none; }
        canvas { display: block; width: 100%; height: 100%; }
        
        #ui { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; display: flex; flex-direction: column; justify-content: space-between; padding: 20px; box-sizing: border-box; }
        #score-board { text-align: center; }
        #score { font-size: 50px; color: #fff; text-shadow: 0 0 10px rgba(255,255,255,0.5); margin: 0; }
        #best-score { font-size: 20px; color: #aaa; margin: 0; }

        #startScreen, #gameOverScreen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(26, 26, 46, 0.95);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 10; pointer-events: auto;
        }
        
        h1 { 
            font-size: 40px; text-align: center; color: #fff; margin-bottom: 10px;
            background: linear-gradient(to right, #ff4d4d, #4d4dff);
            -webkit-background-clip: text; color: transparent;
        }
        
        p { color: #ccc; font-size: 16px; max-width: 80%; text-align: center; line-height: 1.5; }
        
        .btn {
            margin-top: 30px; padding: 15px 40px; font-size: 24px; 
            font-family: 'Orbitron'; color: #fff; background: transparent; 
            border: 2px solid #fff; border-radius: 50px; cursor: pointer;
            transition: 0.2s; box-shadow: 0 0 15px rgba(255,255,255,0.2);
        }
        .btn:active { transform: scale(0.95); background: #fff; color: #000; }
        .hidden { display: none !important; }

        /* Yanıp sönme animasyonu */
        @keyframes flash { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
        .tutorial { animation: flash 2s infinite; font-size: 14px; color: #ffeb3b; margin-top: 20px; }
    </style>
</head>
<body>

<div id="ui">
    <div id="score-board">
        <div id="score">0</div>
        <div id="best-score">BEST: 0</div>
    </div>
</div>

<div id="startScreen">
    <h1>DUAL SPIN<br>2048</h1>
    <p>FLAPPY BIRD + ATEŞ & SU + AA + 2048</p>
    <p class="tutorial">DOKUNARAK ZIPLA<br>KIRMIZIYI KIRMIZIYA, MAVİYİ MAVİYE VUR</p>
    <button class="btn" onclick="startGame()">BAŞLAT</button>
</div>

<div id="gameOverScreen" class="hidden">
    <h1>OYUN BİTTİ</h1>
    <p id="finalScore">SKOR: 0</p>
    <button class="btn" onclick="startGame()">TEKRAR DENE</button>
</div>

<canvas id="gameCanvas"></canvas>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    
    // --- SES MOTORU (Basit) ---
    const AudioContext = window.AudioContext || window.webkitAudioContext;
    const audioCtx = new AudioContext();
    function playSound(type) {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain); gain.connect(audioCtx.destination);
        const now = audioCtx.currentTime;
        
        if (type === 'jump') {
            osc.frequency.setValueAtTime(150, now); osc.frequency.exponentialRampToValueAtTime(300, now+0.1);
            gain.gain.setValueAtTime(0.2, now); gain.gain.linearRampToValueAtTime(0, now+0.1);
            osc.start(now); osc.stop(now+0.1);
        } else if (type === 'merge') {
            osc.type = 'triangle';
            osc.frequency.setValueAtTime(400, now); osc.frequency.linearRampToValueAtTime(800, now+0.1);
            gain.gain.setValueAtTime(0.3, now); gain.gain.linearRampToValueAtTime(0, now+0.2);
            osc.start(now); osc.stop(now+0.2);
        } else if (type === 'crash') {
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(100, now); osc.frequency.exponentialRampToValueAtTime(20, now+0.3);
            gain.gain.setValueAtTime(0.5, now); gain.gain.exponentialRampToValueAtTime(0, now+0.3);
            osc.start(now); osc.stop(now+0.3);
        }
    }

    // --- AYARLAR ---
    let w, h;
    let gameRunning = false;
    let frame = 0;
    let score = 0;
    let bestScore = localStorage.getItem('dualSpinBest') || 0;
    document.getElementById('best-score').innerText = "BEST: " + bestScore;

    // Oyuncu (Dönen Çubuk)
    const player = {
        x: 0, y: 0,
        vy: 0,             // Dikey Hız
        gravity: 0.25,     // Yerçekimi (Flappy)
        jump: -6,          // Zıplama Gücü
        angle: 0,          // Dönüş Açısı (aa)
        rotationSpeed: 0.05,
        length: 40,        // Çubuk uzunluğu (Merkezden uca)
        radius: 12,        // Uçlardaki topların çapı
        redVal: 2,         // Kırmızı uçtaki sayı (2048)
        blueVal: 2         // Mavi uçtaki sayı (2048)
    };

    let obstacles = [];
    let particles = [];
    let speed = 4;

    function resize() {
        w = canvas.width = window.innerWidth;
        h = canvas.height = window.innerHeight;
        player.x = w * 0.3; // Solda sabit
    }
    window.addEventListener('resize', resize);
    resize();

    // Kontrol (Flappy Tarzı)
    function tap(e) {
        if (!gameRunning) return;
        if (e) e.preventDefault(); // Çift dokunma zoom engelle
        player.vy = player.jump;
        playSound('jump');
    }
    document.addEventListener('mousedown', tap);
    document.addEventListener('touchstart', tap, {passive: false});
    document.addEventListener('keydown', e => { if(e.code === 'Space') tap(); });

    function startGame() {
        document.getElementById('startScreen').classList.add('hidden');
        document.getElementById('gameOverScreen').classList.add('hidden');
        gameRunning = true;
        score = 0;
        speed = 4;
        player.y = h / 2;
        player.vy = 0;
        player.redVal = 2;
        player.blueVal = 2;
        player.angle = 0;
        obstacles = [];
        particles = [];
        document.getElementById('score').innerText = score;
        loop();
    }

    function loop() {
        if (!gameRunning) return;
        update();
        draw();
        requestAnimationFrame(loop);
    }

    function update() {
        frame++;
        
        // 1. OYUNCU FİZİĞİ (Flappy + AA)
        player.vy += player.gravity;
        player.y += player.vy;
        player.angle += player.rotationSpeed; // Sürekli dönüyor

        // Zemin/Tavan Kontrolü
        if (player.y > h - 20 || player.y < 20) gameOver();

        // 2. OBJE SİSTEMİ
        if (frame % 90 === 0) spawnObstacle();

        obstacles.forEach(o => {
            o.x -= speed;
            
            // ÇARPIŞMA KONTROLÜ (Karmaşık Kısım)
            // Oyuncunun iki ucunun koordinatlarını hesapla
            // Kırmızı Uç
            let rX = player.x + Math.cos(player.angle) * player.length;
            let rY = player.y + Math.sin(player.angle) * player.length;
            // Mavi Uç
            let bX = player.x + Math.cos(player.angle + Math.PI) * player.length;
            let bY = player.y + Math.sin(player.angle + Math.PI) * player.length;

            if (o.active) {
                // Mesafe kontrolü (Circle Collision)
                let distRed = Math.hypot(rX - o.x, rY - o.y);
                let distBlue = Math.hypot(bX - o.x, bY - o.y);
                let hitDist = player.radius + o.r;

                if (distRed < hitDist) {
                    // Kırmızı Uç Çarptı
                    handleHit('red', o, rX, rY);
                } else if (distBlue < hitDist) {
                    // Mavi Uç Çarptı
                    handleHit('blue', o, bX, bY);
                }
            }
        });

        // Ekrandan çıkanları temizle
        obstacles = obstacles.filter(o => o.x > -50);
        updateParticles();
        
        // Hızlandırma
        speed = 4 + (score / 500);
        player.rotationSpeed = 0.05 + (score / 2000);
    }

    function handleHit(side, obstacle, x, y) {
        // Renk Uyumu Kontrolü (Ateş ve Su Mantığı)
        // side: 'red' veya 'blue'
        // obstacle.type: 'red' veya 'blue'
        
        if (side === obstacle.type) {
            // DOĞRU EŞLEŞME (2048 Mantığı)
            obstacle.active = false;
            playSound('merge');
            
            // Sayı artırma
            let val = (side === 'red') ? player.redVal : player.blueVal;
            
            // Eğer topun üzerindeki sayı ile bizim sayı mantıklıysa
            // Basitleştirme: Her doğru vuruş skoru artırır ve sayıyı katlar
            if (side === 'red') player.redVal *= 2;
            else player.blueVal *= 2;
            
            score += obstacle.val;
            document.getElementById('score').innerText = score;
            
            createParticles(x, y, (side==='red'?'#ff4d4d':'#4d4dff'));
            
        } else {
            // YANLIŞ EŞLEŞME (Yanma)
            gameOver();
        }
    }

    function spawnObstacle() {
        // Rastgele yükseklik
        let yPos = Math.random() * (h - 200) + 100;
        let type = Math.random() > 0.5 ? 'red' : 'blue';
        let val = 2; // Başlangıç değeri
        
        obstacles.push({
            x: w + 50,
            y: yPos,
            r: 25,
            type: type, // 'red' or 'blue'
            val: val,
            active: true
        });
    }

    function gameOver() {
        gameRunning = false;
        playSound('crash');
        if (score > bestScore) {
            bestScore = score;
            localStorage.setItem('dualSpinBest', bestScore);
            document.getElementById('best-score').innerText = "BEST: " + bestScore;
        }
        document.getElementById('gameOverScreen').classList.remove('hidden');
        document.getElementById('finalScore').innerText = "SKOR: " + score;
    }

    // --- ÇİZİM ---
    function draw() {
        // Arka Plan
        ctx.fillStyle = '#1a1a2e';
        ctx.fillRect(0, 0, w, h);
        
        // Grid Çizgileri (Hız hissi için)
        ctx.strokeStyle = 'rgba(255,255,255,0.05)';
        ctx.lineWidth = 2;
        let offset = (frame * speed) % 50;
        for (let i = 0; i < w; i+=50) {
            ctx.beginPath(); ctx.moveTo(i - offset, 0); ctx.lineTo(i - offset, h); ctx.stroke();
        }

        // OBJE ÇİZİMİ
        obstacles.forEach(o => {
            if (!o.active) return;
            
            let color = o.type === 'red' ? '#ff4d4d' : '#4d4dff';
            
            // Glow
            ctx.shadowBlur = 20; ctx.shadowColor = color;
            ctx.fillStyle = color;
            
            ctx.beginPath();
            ctx.arc(o.x, o.y, o.r, 0, Math.PI * 2);
            ctx.fill();
            
            // Sayı
            ctx.shadowBlur = 0;
            ctx.fillStyle = '#fff';
            ctx.font = "bold 16px Arial";
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            ctx.fillText(o.val, o.x, o.y);
        });

        // OYUNCU ÇİZİMİ
        ctx.save();
        ctx.translate(player.x, player.y);
        ctx.rotate(player.angle); // aa Dönüşü

        // Çubuk
        ctx.strokeStyle = '#fff';
        ctx.lineWidth = 4;
        ctx.beginPath();
        ctx.moveTo(-player.length, 0);
        ctx.lineTo(player.length, 0);
        ctx.stroke();

        // Mavi Top (Sol - Math.PI)
        ctx.shadowBlur = 15; ctx.shadowColor = '#4d4dff';
        ctx.fillStyle = '#4d4dff';
        ctx.beginPath(); ctx.arc(-player.length, 0, player.radius, 0, Math.PI*2); ctx.fill();
        // Mavi Sayı
        ctx.shadowBlur = 0; ctx.fillStyle = '#fff'; ctx.font = "10px Arial";
        ctx.save(); ctx.translate(-player.length, 0); ctx.rotate(-player.angle); // Yazıyı düz tut
        ctx.fillText(simpleVal(player.blueVal), 0, 0); ctx.restore();

        // Kırmızı Top (Sağ - 0)
        ctx.shadowBlur = 15; ctx.shadowColor = '#ff4d4d';
        ctx.fillStyle = '#ff4d4d';
        ctx.beginPath(); ctx.arc(player.length, 0, player.radius, 0, Math.PI*2); ctx.fill();
        // Kırmızı Sayı
        ctx.shadowBlur = 0; ctx.fillStyle = '#fff';
        ctx.save(); ctx.translate(player.length, 0); ctx.rotate(-player.angle); // Yazıyı düz tut
        ctx.fillText(simpleVal(player.redVal), 0, 0); ctx.restore();

        ctx.restore();
        
        drawParticles();
    }

    // Büyük sayıları kısaltma (2048 -> 2k gibi gerekirse)
    function simpleVal(n) {
        if (n >= 1000) return (n/1000).toFixed(1) + 'k';
        return n;
    }

    // Efektler
    function createParticles(x, y, color) {
        for(let i=0; i<10; i++) {
            particles.push({
                x: x, y: y,
                vx: (Math.random()-0.5)*10, vy: (Math.random()-0.5)*10,
                life: 1, color: color
            });
        }
    }
    function updateParticles() {
        for(let i=particles.length-1; i>=0; i--) {
            let p = particles[i];
            p.x += p.vx; p.y += p.vy; p.life -= 0.05;
            if (p.life <= 0) particles.splice(i, 1);
        }
    }
    function drawParticles() {
        particles.forEach(p => {
            ctx.globalAlpha = p.life;
            ctx.fillStyle = p.color;
            ctx.beginPath(); ctx.arc(p.x, p.y, 3, 0, Math.PI*2); ctx.fill();
        });
        ctx.globalAlpha = 1;
    }
</script>
</body>
</html>